<!-- 
/*
 * 
 *                  xxxxxxx      xxxxxxx
 *                   x:::::x    x:::::x 
 *                    x:::::x  x:::::x  
 *                     x:::::xx:::::x   
 *                      x::::::::::x    
 *                       x::::::::x     
 *                       x::::::::x     
 *                      x::::::::::x    
 *                     x:::::xx:::::x   
 *                    x:::::x  x:::::x  
 *                   x:::::x    x:::::x 
 *              THE xxxxxxx      xxxxxxx TOOLKIT
 *                    
 *                  http://www.goXTK.com
 *                   
 * Copyright (c) 2012 The X Toolkit Developers <dev@goXTK.com>
 *                   
 *    The X Toolkit (XTK) is licensed under the MIT License:
 *      http://www.opensource.org/licenses/mit-license.php
 *
 * LESSON 10 - Slice it!
 */
-->

<html>
<head>
<title>XTK LESSON 10</title>

<!-- <script type="text/javascript" src="http://get.goXTK.com/xtk.js"></script> -->
<script type="text/javascript" src="../../X/lib/closure-library/closure/goog/base.js"></script>
<script type="text/javascript" src="../../X/xtk-deps.js"></script>
<script type="text/javascript" src="dat.gui.min.js"></script>

<script type="text/javascript">

  goog.require('X.renderer');
  goog.require('X.volume');

  var run = function() {
    
    var r = new X.renderer('r');
    r.init();
    
    // load a .NRRD file to the X.volume
    // this works with gzip/gz/raw encoded NRRD files
    var volume = new X.volume();
    volume.load('../data/avf.nrrd');
    
    //r.add(model);
    r.add(volume);
    
    r.camera().setPosition(120,80,160);
    r.render();
    
    r.onShowtime = function() {
      
      //
	    // The GUI panel
	    //
	    // (we need to create this during onShowtime(..) since we do not know the volume
	    // dimensions before the loading was completed)
	    
	    // a container to perform some actions
        var loader = {
          Load:function() {

            // also add a segmentation
            var model = new X.object();
            model.load('../data/avf-label.vtk');
            
            r.onShowtime = function() {
              
              
              
            };
            
            r.add(model);
            r.render();
            
            
          }
        };
	    
	    var gui = new dat.GUI();
	    var volumegui = gui.addFolder('Volume');
	    // ,, switch between slicing and volume rendering
	    var vrController = volumegui.add(volume, '_volumeRendering');
	    // .. configure the volume rendering opacity
	    var opacityController = volumegui.add(volume, '_opacity', 0,1);
	    // .. we can threshold
	    var lowerThresholdController = volumegui.add(volume, '_lowerThreshold', volume.scalarRange()[0], volume.scalarRange()[1]);
	    var upperThresholdController = volumegui.add(volume, '_upperThreshold', volume.scalarRange()[0], volume.scalarRange()[1]);
	    var sliceXController = volumegui.add(volume, '_indexX', 0, volume.dimensions()[0]-1);
	    var sliceYController = volumegui.add(volume, '_indexY', 0, volume.dimensions()[1]-1);
	    var sliceZController = volumegui.add(volume, '_indexZ', 0, volume.dimensions()[2]-1);
	    volumegui.open();
	    var modelgui = gui.addFolder('Model');
	    var addModelController = modelgui.add(loader,'Load');
	    modelgui.open();
	    
	    vrController.onChange(function(value) {
	      
	      document.getElementById('r').style.backgroundColor = value ? '#000000' : '#ffffff';
	      
	      volume.modified();
	      r.render();
	    });
	    
      opacityController.onChange(function(value){
        volume.modified();
        r.render();
      });	    
	    
	    lowerThresholdController.onChange(function(value){
	      volume.modified();
	      r.render();
	    });

      upperThresholdController.onChange(function(value){
        volume.modified();
        r.render();
      });	    
	    
	    sliceXController.onChange(function(value) {
	      volume.modified();
	      r.render();
	    });
	    sliceYController.onChange(function(value) {
	      volume.modified();
	      r.render();
	    });          
	    sliceZController.onChange(function(value) {
	      volume.modified();
	      r.render();
	    });              
	    
    };
    
    
  };
</script>

<body onload="run()" style="margin:0px;">
  
  <!-- the container for the renderer -->
  <div id="r" style="background-color: #ffffff; width: 100%; height: 100%;"></div>
    
</body>